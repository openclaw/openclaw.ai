---
// Icon component that renders either a Simple Icons SVG path or a Lucide icon name
type IconPath = {
  d: string;
  fill?: string;
  stroke?: string;
  strokeWidth?: number;
  strokeLinejoin?: string;
  strokeLinecap?: string;
  strokeDasharray?: string;
};

type GradientStop = {
  offset: string;
  color: string;
  opacity?: number;
};

type LinearGradient = {
  id: string;
  x1?: string;
  y1?: string;
  x2?: string;
  y2?: string;
  stops: GradientStop[];
};

type CustomIcon = {
  viewBox: string;
  paths: IconPath[];
  defs?: {
    linearGradients?: LinearGradient[];
  };
};

interface Props {
  icon: string | CustomIcon;
  color?: string;
  size?: number;
  class?: string;
}

import {
  Globe, Mic, Clock, Webhook, CloudSun, Image, Camera, Search, Mail,
  StickyNote, CheckSquare, ListTodo, PenTool, Bed, ShoppingCart, Printer,
  Heart, UtensilsCrossed, MonitorSmartphone, Eye, Monitor, Bot, Users, Hash,
  Home, MessageCircle, Brain, Terminal, Puzzle, Zap
} from 'lucide-astro';

const { icon, color = 'currentColor', size = 24, class: className = '' } = Astro.props;

// Map lucide icon names to components
const lucideIcons: Record<string, any> = {
  'lucide:globe': Globe,
  'lucide:mic': Mic,
  'lucide:clock': Clock,
  'lucide:webhook': Webhook,
  'lucide:cloud-sun': CloudSun,
  'lucide:image': Image,
  'lucide:camera': Camera,
  'lucide:search': Search,
  'lucide:mail': Mail,
  'lucide:sticky-note': StickyNote,
  'lucide:check-square': CheckSquare,
  'lucide:list-todo': ListTodo,
  'lucide:pen-tool': PenTool,
  'lucide:bed': Bed,
  'lucide:shopping-cart': ShoppingCart,
  'lucide:printer': Printer,
  'lucide:heart': Heart,
  'lucide:utensils-crossed': UtensilsCrossed,
  'lucide:monitor-smartphone': MonitorSmartphone,
  'lucide:eye': Eye,
  'lucide:monitor': Monitor,
  'lucide:bot': Bot,
  'lucide:users': Users,
  'lucide:hash': Hash,
  'lucide:home': Home,
  'lucide:message-circle': MessageCircle,
  'lucide:brain': Brain,
  'lucide:terminal': Terminal,
  'lucide:puzzle': Puzzle,
  'lucide:zap': Zap,
};

const isStringIcon = typeof icon === 'string';
const isLucide = isStringIcon && icon.startsWith('lucide:');
const LucideComponent = isLucide ? lucideIcons[icon] : null;
const customIcon = !isStringIcon ? icon : null;
---

{isLucide && LucideComponent ? (
  <LucideComponent size={size} color={color} class={className} />
) : customIcon ? (
  <svg
    viewBox={customIcon.viewBox}
    width={size}
    height={size}
    class={className}
    style={`color: ${color}`}
    xmlns="http://www.w3.org/2000/svg"
  >
    {customIcon.defs?.linearGradients && (
      <defs>
        {customIcon.defs.linearGradients.map((grad) => (
          <linearGradient id={grad.id} x1={grad.x1 ?? "0%"} y1={grad.y1 ?? "0%"} x2={grad.x2 ?? "100%"} y2={grad.y2 ?? "0%"}>
            {grad.stops.map((stop) => (
              <stop offset={stop.offset} stop-color={stop.color} stop-opacity={stop.opacity ?? 1} />
            ))}
          </linearGradient>
        ))}
      </defs>
    )}
    {customIcon.paths.map((path) => (
      <path
        d={path.d}
        fill={path.fill ?? color}
        stroke={path.stroke}
        stroke-width={path.strokeWidth}
        stroke-linejoin={path.strokeLinejoin}
        stroke-linecap={path.strokeLinecap}
        stroke-dasharray={path.strokeDasharray}
      />
    ))}
  </svg>
) : (
  <svg
    viewBox="0 0 24 24"
    width={size}
    height={size}
    fill={color}
    class={className}
    xmlns="http://www.w3.org/2000/svg"
  >
    <path d={icon} />
  </svg>
)}
