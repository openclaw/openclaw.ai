# OpenClaw 위협 모델
# MITRE ATLAS 프레임워크 기반 (AI 시스템을 위한 적대적 위협 환경)
# Version: 1.0-draft
# Last Updated: 2026-02-04
# Methodology: MITRE ATLAS + Data Flow Diagrams
#
# 기여 방법: CONTRIBUTING.md 참조
# 보안 문제 신고: security@openclaw.ai

metadata:
  version: "1.0-draft"
  last_updated: "2026-02-04"
  methodology: MITRE ATLAS + 데이터 흐름 다이어그램
  framework: MITRE ATLAS (AI 시스템을 위한 적대적 위협 환경)
  framework_url: https://atlas.mitre.org/
  atlas_resources:
    - name: ATLAS 기법
      url: https://atlas.mitre.org/techniques/
    - name: ATLAS 전술
      url: https://atlas.mitre.org/tactics/
    - name: ATLAS 사례 연구
      url: https://atlas.mitre.org/studies/
    - name: ATLAS GitHub
      url: https://github.com/mitre-atlas/atlas-data
    - name: ATLAS 기여하기
      url: https://atlas.mitre.org/resources/contribute

scope:
  included:
    - component: OpenClaw Agent Runtime
      notes: 핵심 에이전트 실행, 도구 호출, 세션
    - component: Gateway
      notes: 인증, 라우팅, 채널 연동
    - component: Channel Integrations
      notes: WhatsApp, Telegram, Discord, Signal, Slack 등
    - component: ClawHub Marketplace
      notes: 스킬 게시, 검수, 배포
    - component: MCP Servers
      notes: 외부 도구 제공자
    - component: User Devices
      notes: 모바일 앱, 데스크톱 클라이언트 (일부)
  out_of_scope: 이 위협 모델에서 명시적으로 범위 밖으로 지정된 항목은 없습니다.

tactics:
  - id: recon
    name: 정찰
    atlas: AML.TA0002
    color: "#6b7280"
  - id: access
    name: 초기 접근
    atlas: AML.TA0004
    color: "#8b5cf6"
  - id: execution
    name: 실행
    atlas: AML.TA0005
    color: "#ef4444"
  - id: persistence
    name: 지속성 확보
    atlas: AML.TA0006
    color: "#f97316"
  - id: evasion
    name: 방어 회피
    atlas: AML.TA0007
    color: "#eab308"
  - id: discovery
    name: 탐색
    atlas: AML.TA0008
    color: "#22c55e"
  - id: exfil
    name: 유출
    atlas: AML.TA0010
    color: "#3b82f6"
  - id: impact
    name: 영향
    atlas: AML.TA0011
    color: "#ec4899"

threats:
  # ── 정찰 (AML.TA0002) ────────────────────────────
  - id: T-RECON-001
    name: 에이전트 엔드포인트 탐지
    tactic: Reconnaissance
    atlas: AML.T0006
    risk: Medium
    category: recon
    description: 공격자가 노출된 OpenClaw 게이트웨이 엔드포인트를 탐색합니다
    attackVector: 네트워크 스캔, Shodan 쿼리, DNS 열거
    affected: 게이트웨이, 노출된 API 엔드포인트
    mitigations: Tailscale 인증 옵션, 기본적으로 루프백에 바인딩
    residualRisk: 공개 게이트웨이가 발견될 수 있음
    recommendations: 보안 배포 문서화, 탐지 엔드포인트에 속도 제한 추가

  - id: T-RECON-002
    name: 채널 연동 탐색
    tactic: Reconnaissance
    atlas: AML.T0006
    risk: Low
    category: recon
    description: 공격자가 메시징 채널을 탐색하여 AI 관리 계정을 식별합니다
    attackVector: 테스트 메시지 전송, 응답 패턴 관찰
    affected: 모든 채널 연동
    mitigations: 특별한 대책 없음
    residualRisk: 탐지 자체만으로는 제한된 가치
    recommendations: 응답 타이밍 무작위화 고려

  - id: T-RECON-003
    name: 스킬 기능 정찰
    tactic: Reconnaissance
    atlas: AML.T0006
    risk: Low
    category: recon
    description: 공격자가 ClawHub를 분석하여 고가치 대상과 인기 스킬을 식별합니다
    attackVector: ClawHub 탐색, 다운로드 통계 분석, 민감한 권한을 가진 스킬 식별
    affected: ClawHub 공개 목록
    mitigations: 없음 - 설계상 공개
    residualRisk: 공격자가 대상의 우선순위를 정할 수 있음
    recommendations: 의심스러운 탐색 패턴 모니터링, API 접근 속도 제한

  # ── 초기 접근 (AML.TA0004) ────────────────────────────
  - id: T-ACCESS-001
    name: 페어링 코드 가로채기
    tactic: Initial Access
    atlas: AML.T0040
    risk: Medium
    category: access
    description: 공격자가 30초 유예 기간 동안 페어링 코드를 가로챕니다
    attackVector: 어깨 너머로 엿보기, 네트워크 스니핑, 사회 공학
    affected: 기기 페어링 시스템
    mitigations: 30초 만료, 기존 채널을 통한 코드 전송
    residualRisk: 유예 기간 악용 가능
    recommendations: 유예 기간 단축, 확인 단계 추가

  - id: T-ACCESS-002
    name: AllowFrom 스푸핑
    tactic: Initial Access
    atlas: AML.T0040
    risk: Medium
    category: access
    description: 공격자가 채널에서 허용된 발신자 신원을 위조합니다
    attackVector: 전화번호 스푸핑, 사용자명 사칭 (채널에 따라 다름)
    affected: 채널별 AllowFrom 검증
    mitigations: 채널별 신원 확인
    residualRisk: 일부 채널에서 스푸핑 취약
    recommendations: 채널별 위험 문서화, 가능한 경우 암호화 검증 추가

  - id: T-ACCESS-003
    name: 토큰 탈취
    tactic: Initial Access
    atlas: AML.T0040
    risk: High
    category: access
    description: 공격자가 설정 파일에서 인증 토큰을 탈취합니다
    attackVector: 악성코드, 무단 기기 접근, 설정 백업 노출
    affected: ~/.openclaw/credentials/, 설정 저장소
    mitigations: 파일 권한 설정
    residualRisk: 토큰이 평문으로 저장됨
    recommendations: 저장 시 토큰 암호화 구현, 토큰 순환 추가

  - id: T-ACCESS-004
    name: 악성 스킬을 통한 초기 접근
    tactic: Initial Access
    atlas: AML.T0010.001
    risk: Critical
    category: access
    description: 사용자가 ClawHub에서 악성 스킬을 설치하여 공격자에게 초기 접근 권한을 부여합니다
    attackVector: 사회 공학, 타이포스쿼팅, 인기 스킬 위장, SEO 조작
    affected: ClawHub 탐색, 스킬 설치 흐름
    mitigations: GitHub 계정 생성 일자 확인, 다운로드 통계 표시
    residualRisk: 사용자가 확인 없이 설치할 수 있음
    recommendations: 눈에 띄는 보안 경고, 인증된 게시자 배지, 설치 확인 절차

  - id: T-ACCESS-005
    name: 손상된 스킬 업데이트
    tactic: Initial Access
    atlas: AML.T0010.001
    risk: High
    category: access
    description: 공격자가 합법적인 스킬을 손상시키고 기존 사용자에게 악성 업데이트를 배포합니다
    attackVector: 스킬 게시자 계정 탈취, 사회 공학, 자격 증명 탈취
    affected: ClawHub 업데이트 메커니즘, 기존 스킬 설치
    mitigations: 버전 핑거프린팅
    residualRisk: 신뢰할 수 있는 스킬이 공격 벡터로 전환됨
    recommendations: 업데이트 서명, 게시자 2FA 필수화, 업데이트 변경사항 검토

  - id: T-ACCESS-006
    name: 채널을 통한 프롬프트 인젝션
    tactic: Initial Access
    atlas: AML.T0051.000
    risk: High
    category: access
    description: 공격자가 메시징 채널을 통해 악성 프롬프트를 전송하여 초기 접근을 획득합니다
    attackVector: 에이전트 관리 채널(WhatsApp, Telegram, Discord)로 직접 메시지 전송
    affected: 모든 채널 연동
    mitigations: AllowFrom 목록, 페어링 요구사항
    residualRisk: 잘못 구성된 허용 목록, 추가되기 위한 사회 공학
    recommendations: 기본 채널 접근 거부, 새 발신자에 대한 감사 로깅

  # ── 실행 (AML.TA0005) ─────────────────────────────────
  - id: T-EXEC-001
    name: 직접 프롬프트 인젝션
    tactic: Execution
    atlas: AML.T0051.000
    risk: Critical
    category: execution
    description: 공격자가 조작된 프롬프트를 전송하여 에이전트 동작을 조작합니다
    attackVector: 적대적 명령이 포함된 채널 메시지
    affected: 에이전트 LLM, 모든 입력 표면
    mitigations: 패턴 감지, 외부 콘텐츠 래핑
    residualRisk: "감지만 가능하고 차단 불가; 정교한 공격은 우회"
    recommendations: 다층 방어 구현, 출력 검증, 민감한 작업에 대한 사용자 확인

  - id: T-EXEC-002
    name: 간접 프롬프트 인젝션
    tactic: Execution
    atlas: AML.T0051.001
    risk: High
    category: execution
    description: 공격자가 가져온 콘텐츠에 악성 명령을 삽입합니다
    attackVector: 악성 URL, 오염된 이메일, 손상된 웹훅
    affected: web_fetch, 이메일 수집, 외부 데이터 소스
    mitigations: XML 태그와 보안 알림으로 콘텐츠 래핑
    residualRisk: LLM이 래퍼 명령을 무시할 수 있음
    recommendations: 콘텐츠 정화 구현, 실행 컨텍스트 분리

  - id: T-EXEC-003
    name: 도구 인자 인젝션
    tactic: Execution
    atlas: AML.T0051.000
    risk: High
    category: execution
    description: 공격자가 프롬프트 인젝션을 통해 도구 인자를 조작합니다
    attackVector: 도구 매개변수 값에 영향을 미치는 조작된 프롬프트
    affected: 모든 도구 호출
    mitigations: 위험한 명령에 대한 실행 승인
    residualRisk: 사용자 판단에 의존
    recommendations: 인자 검증 구현, 매개변수화된 도구 호출

  - id: T-EXEC-004
    name: 실행 승인 우회
    tactic: Execution
    atlas: AML.T0043
    risk: High
    category: execution
    description: 공격자가 승인 허용 목록을 우회하는 명령을 조작합니다
    attackVector: 명령 난독화, 별칭 악용, 경로 조작
    affected: exec-approvals.ts, 명령 허용 목록
    mitigations: 허용 목록 + 질의 모드
    residualRisk: 명령 정화 없음
    recommendations: 명령 정규화 구현, 차단 목록 확장

  - id: T-EXEC-005
    name: 악성 스킬 코드 실행
    tactic: Execution
    atlas: AML.T0010.001
    risk: Critical
    category: execution
    description: 악성 스킬이 에이전트에 로드될 때 임의 코드를 실행합니다
    attackVector: 스킬에 로드 또는 호출 시 실행되는 난독화된 악성 코드 포함
    affected: 스킬 런타임, 에이전트 프로세스, 호스트 시스템
    mitigations: 패턴 기반 검수 (쉽게 우회 가능)
    residualRisk: 스킬이 에이전트 전체 권한으로 실행되며, 샌드박스 없음
    recommendations: VirusTotal Code Insight, 스킬 샌드박싱, 기능 기반 권한

  - id: T-EXEC-006
    name: MCP 서버 명령 인젝션
    tactic: Execution
    atlas: AML.T0051.000
    risk: High
    category: execution
    description: 공격자가 MCP 서버를 악용하여 도구 호출을 통해 명령을 실행합니다
    attackVector: 프롬프트 인젝션으로 에이전트가 악성 인자로 MCP 도구를 호출하도록 유도
    affected: MCP 서버 연동, 외부 도구 제공자
    mitigations: 도구 정책 적용
    residualRisk: MCP 서버가 광범위한 권한을 가질 수 있음
    recommendations: MCP 서버 허용 목록, 인자 검증, 최소 권한 MCP 설정

  # ── 지속성 확보 (AML.TA0006) ───────────────────────────
  - id: T-PERSIST-001
    name: 스킬 기반 지속성
    tactic: Persistence
    atlas: AML.T0010.001
    risk: Critical
    category: persistence
    description: 악성 스킬이 설치된 채로 유지되어 에이전트 재시작 시에도 재실행됩니다
    attackVector: 스킬이 사용자 설정에 유지되고 에이전트 시작 시 자동 로드됨
    affected: 스킬 설치, 에이전트 시작
    mitigations: 없음 - 스킬은 설계상 유지됨
    residualRisk: 악성 스킬이 재부팅 및 업데이트 후에도 생존
    recommendations: 로드 시 스킬 무결성 검증, 주기적 재검사, 제거 도구

  - id: T-PERSIST-002
    name: 오염된 스킬 업데이트 지속성
    tactic: Persistence
    atlas: AML.T0010.001
    risk: High
    category: persistence
    description: 합법적인 스킬에 대한 악성 업데이트가 지속적인 접근을 유지합니다
    attackVector: 자동 업데이트가 손상된 버전을 가져와 세션 간 지속됨
    affected: ClawHub 버전 관리, 자동 업데이트 흐름
    mitigations: 버전 핑거프린팅
    residualRisk: 신뢰할 수 있는 스킬이 영구 백도어로 전환됨
    recommendations: 업데이트 서명, 버전 고정, 업데이트 알림

  - id: T-PERSIST-003
    name: 에이전트 설정 변조
    tactic: Persistence
    atlas: AML.T0010.002
    risk: Medium
    category: persistence
    description: 공격자가 에이전트 설정을 수정하여 접근을 지속합니다
    attackVector: 설정 파일 수정, 손상된 스킬을 통한 설정 주입
    affected: 에이전트 설정, 도구 정책, 허용 목록
    mitigations: 파일 권한 설정
    residualRisk: 로컬 접근 또는 사전 침해가 필요
    recommendations: 설정 무결성 검증, 설정 변경에 대한 감사 로깅

  - id: T-PERSIST-004
    name: 탈취된 토큰 지속성
    tactic: Persistence
    atlas: AML.T0040
    risk: High
    category: persistence
    description: 공격자가 탈취한 인증 토큰을 사용하여 접근을 유지합니다
    attackVector: T-ACCESS-003을 통해 탈취된 토큰으로 지속적 접근
    affected: 게이트웨이 인증, API 접근
    mitigations: "없음 - 토큰이 기본적으로 만료되지 않음"
    residualRisk: 토큰을 수동으로 폐기할 때까지 공격자가 접근 유지
    recommendations: 토큰 만료, 순환 정책, 이상 탐지

  - id: T-PERSIST-005
    name: 프롬프트 인젝션 메모리 오염
    tactic: Persistence
    atlas: AML.T0051.000
    risk: Medium
    category: persistence
    description: 공격자가 에이전트 메모리/컨텍스트에 지속되는 명령을 주입합니다
    attackVector: 후속 상호작용의 에이전트 동작을 변경하는 프롬프트 주입
    affected: 세션 컨텍스트, 에이전트 메모리 시스템
    mitigations: 발신자별 세션 격리
    residualRisk: 세션 내 지속성 가능
    recommendations: 컨텍스트 정화, 메모리 경계, 세션 타임아웃

  # ── 방어 회피 (AML.TA0007) ───────────────────────────
  - id: T-EVADE-001
    name: 검수 패턴 우회
    tactic: Defense Evasion
    atlas: AML.T0043
    risk: High
    category: evasion
    description: 공격자가 검수 패턴을 회피하도록 스킬 콘텐츠를 조작합니다
    attackVector: 유니코드 호모글리프, 인코딩 트릭, 동적 로딩, 코드 난독화
    affected: ClawHub moderation.ts
    mitigations: 패턴 기반 FLAG_RULES
    residualRisk: 단순한 정규식은 쉽게 우회됨
    recommendations: 행위 분석 추가 (VirusTotal Code Insight), AST 기반 탐지

  - id: T-EVADE-002
    name: 콘텐츠 래퍼 탈출
    tactic: Defense Evasion
    atlas: AML.T0043
    risk: Medium
    category: evasion
    description: 공격자가 XML 래퍼 컨텍스트를 탈출하는 콘텐츠를 조작합니다
    attackVector: 태그 조작, 컨텍스트 혼란, 명령 덮어쓰기
    affected: 외부 콘텐츠 래핑
    mitigations: XML 태그 + 보안 알림
    residualRisk: 새로운 탈출 방법이 정기적으로 발견됨
    recommendations: 다중 래퍼 레이어, 출력 측 검증

  - id: T-EVADE-003
    name: 승인 프롬프트 조작
    tactic: Defense Evasion
    atlas: AML.T0043
    risk: Medium
    category: evasion
    description: 공격자가 승인 프롬프트에서 무해하게 보이는 요청을 조작합니다
    attackVector: 오해를 유발하는 명령 설명, 긴 명령에 악성 플래그 숨기기
    affected: 실행 승인 UI, 사용자 의사 결정
    mitigations: 승인 프롬프트에 전체 명령 표시
    residualRisk: 사용자가 꼼꼼히 검토하지 않고 승인할 수 있음
    recommendations: 위험한 플래그 강조, 명령 요약, 위험도 점수화

  - id: T-EVADE-004
    name: 단계적 페이로드 전달
    tactic: Defense Evasion
    atlas: AML.T0043
    risk: High
    category: evasion
    description: 스킬이 초기 검사를 통과한 후 악성 페이로드를 다운로드합니다
    attackVector: 정상 스킬이 검수를 통과한 후 런타임에 악성 코드를 가져옴
    affected: ClawHub 검사, 스킬 런타임
    mitigations: 없음 - 런타임 페치가 모니터링되지 않음
    residualRisk: 검사가 초기 코드만 확인
    recommendations: 런타임 네트워크 모니터링, 스킬의 아웃바운드 페치 제한

  # ── 탐색 (AML.TA0008) ─────────────────────────────────
  - id: T-DISC-001
    name: 도구 열거
    tactic: Discovery
    atlas: AML.T0040
    risk: Low
    category: discovery
    description: 공격자가 프롬프트를 통해 사용 가능한 도구를 열거합니다
    attackVector: "'어떤 도구를 가지고 있나요?' 유형의 질의"
    affected: 에이전트 도구 레지스트리
    mitigations: 특별한 대책 없음
    residualRisk: 도구는 일반적으로 문서화되어 있음
    recommendations: 도구 가시성 제어 고려

  - id: T-DISC-002
    name: 세션 데이터 추출
    tactic: Discovery
    atlas: AML.T0040
    risk: Medium
    category: discovery
    description: 공격자가 세션 컨텍스트에서 민감한 데이터를 추출합니다
    attackVector: "'무엇을 논의했나요?' 질의, 컨텍스트 탐색"
    affected: 세션 기록, 컨텍스트 윈도우
    mitigations: 발신자별 세션 격리
    residualRisk: 세션 내 데이터 접근 가능
    recommendations: 컨텍스트 내 민감한 데이터 삭제 구현

  - id: T-DISC-003
    name: 시스템 프롬프트 추출
    tactic: Discovery
    atlas: AML.T0040
    risk: Medium
    category: discovery
    description: 공격자가 시스템 프롬프트를 추출하여 에이전트의 기능과 제한사항을 파악합니다
    attackVector: 에이전트에게 지침을 공개하도록 요청하는 프롬프트 인젝션
    affected: 에이전트 시스템 프롬프트, 보안 정책
    mitigations: LLM 명령 수행 능력
    residualRisk: 창의적인 프롬프트로 시스템 프롬프트를 추출할 수 있는 경우가 많음
    recommendations: 시스템 프롬프트 강화, 추출 탐지

  - id: T-DISC-004
    name: 환경 열거
    tactic: Discovery
    atlas: AML.T0040
    risk: Medium
    category: discovery
    description: 공격자가 환경 변수와 시스템 설정을 열거합니다
    attackVector: 프롬프트 인젝션으로 에이전트가 env, printenv를 실행하거나 설정 파일을 읽도록 유도
    affected: 호스트 환경, 환경 변수의 자격 증명
    mitigations: 실행 승인
    residualRisk: 승인된 명령이 민감한 정보를 노출할 수 있음
    recommendations: 민감한 환경 변수 필터링, 출력 삭제

  # ── 유출 (AML.TA0010) ──────────────────────────────
  - id: T-EXFIL-001
    name: web_fetch를 통한 데이터 탈취
    tactic: Exfiltration
    atlas: AML.T0009
    risk: High
    category: exfil
    description: 공격자가 에이전트에게 외부 URL로 데이터를 전송하도록 지시하여 데이터를 탈취합니다
    attackVector: 프롬프트 인젝션으로 에이전트가 공격자 서버에 데이터를 POST하도록 유도
    affected: web_fetch 도구
    mitigations: 내부 네트워크에 대한 SSRF 차단
    residualRisk: 외부 URL 허용됨
    recommendations: URL 허용 목록 구현, 데이터 분류 인식

  - id: T-EXFIL-002
    name: 무단 메시지 전송
    tactic: Exfiltration
    atlas: AML.T0009
    risk: Medium
    category: exfil
    description: 공격자가 에이전트에게 민감한 데이터가 포함된 메시지를 전송하도록 유도합니다
    attackVector: 프롬프트 인젝션으로 에이전트가 공격자에게 메시지를 보내도록 유도
    affected: 메시지 도구, 채널 연동
    mitigations: 아웃바운드 메시징 게이팅
    residualRisk: 게이팅이 우회될 수 있음
    recommendations: 새 수신자에 대한 명시적 확인 필요

  - id: T-EXFIL-003
    name: 스킬을 통한 자격 증명 수집
    tactic: Exfiltration
    atlas: AML.T0009
    risk: Critical
    category: exfil
    description: 악성 스킬이 에이전트 컨텍스트와 환경에서 자격 증명을 수집합니다
    attackVector: 스킬 코드가 환경 변수, 설정 파일, API 키를 읽음
    affected: 스킬 실행 환경, ~/.openclaw/
    mitigations: 스킬에 특화된 대책 없음
    residualRisk: 스킬이 에이전트 권한으로 실행됨
    recommendations: 스킬 샌드박싱, 자격 증명 격리, 기능 기반 접근

  - id: T-EXFIL-004
    name: 대화 기록 유출
    tactic: Exfiltration
    atlas: AML.T0009
    risk: High
    category: exfil
    description: 공격자가 민감한 데이터가 포함된 대화 기록을 유출합니다
    attackVector: 스킬 또는 프롬프트 인젝션이 기록 파일을 읽고 전송
    affected: 세션 기록, ~/.openclaw/sessions/
    mitigations: 파일 권한 설정
    residualRisk: 스킬이 기록 파일을 읽을 수 있음
    recommendations: 기록 암호화, 스킬 파일시스템 격리

  # ── 영향 (AML.TA0011) ────────────────────────────────
  - id: T-IMPACT-001
    name: 무단 명령 실행
    tactic: Impact
    atlas: AML.T0031
    risk: Critical
    category: impact
    description: 공격자가 사용자 시스템에서 임의 명령을 실행합니다
    attackVector: 프롬프트 인젝션과 실행 승인 우회의 결합
    affected: Bash 도구, 명령 실행, 호스트 시스템
    mitigations: 실행 승인, Docker 샌드박스 옵션
    residualRisk: 샌드박스 없이 호스트에서 실행
    recommendations: 기본 샌드박스 적용, 승인 UX 개선

  - id: T-IMPACT-002
    name: 리소스 고갈 (DoS)
    tactic: Impact
    atlas: AML.T0031
    risk: High
    category: impact
    description: 공격자가 API 크레딧이나 컴퓨팅 리소스를 고갈시킵니다
    attackVector: 자동화된 메시지 폭주, 비용이 높은 도구 호출, 무한 루프
    affected: 게이트웨이, 에이전트 세션, API 제공자, 사용자 과금
    mitigations: 없음
    residualRisk: 속도 제한 없음
    recommendations: 발신자별 속도 제한 구현, 비용 예산, 서킷 브레이커

  - id: T-IMPACT-003
    name: 평판 손상
    tactic: Impact
    atlas: AML.T0031
    risk: Medium
    category: impact
    description: 공격자가 에이전트에게 유해하거나 불쾌한 콘텐츠를 전송하도록 유도합니다
    attackVector: 연락처에 부적절한 응답을 유발하는 프롬프트 인젝션
    affected: 출력 생성, 채널 메시징, 사용자 평판
    mitigations: LLM 제공자 콘텐츠 정책
    residualRisk: 제공자 필터가 불완전함
    recommendations: 출력 필터링 레이어, 사용자 제어, 메시지 검토 대기열

  - id: T-IMPACT-004
    name: 데이터 파괴
    tactic: Impact
    atlas: AML.T0031
    risk: High
    category: impact
    description: 공격자가 에이전트에게 사용자 데이터를 삭제하거나 손상시키도록 유도합니다
    attackVector: rm, format 또는 파괴적인 데이터베이스 작업을 유발하는 프롬프트 인젝션
    affected: 사용자 파일, 데이터베이스, 설정
    mitigations: 파괴적 명령에 대한 실행 승인
    residualRisk: 승인된 파괴적 명령이 위장될 수 있음
    recommendations: 파괴적 명령 확인, 백업 권장, 실행 취소 기능

  - id: T-IMPACT-005
    name: 에이전트를 통한 금융 사기
    tactic: Impact
    atlas: AML.T0031
    risk: High
    category: impact
    description: 공격자가 에이전트를 사용하여 무단 금융 거래를 수행합니다
    attackVector: 프롬프트 인젝션으로 에이전트가 금융 API 또는 서비스와 상호작용하도록 유도
    affected: 금융 연동, 결제 도구
    mitigations: 도구별 정책
    residualRisk: 에이전트가 금융 도구에 접근할 수 있음
    recommendations: 금융 작업 확인, 거래 한도, 별도 승인 흐름

attack_chains:
  - name: 악성 스킬 전체 킬 체인
    steps: [T-RECON-003, T-EVADE-001, T-ACCESS-004, T-EXEC-005, T-PERSIST-001, T-EXFIL-003]
    description: "ClawHub 정찰 \u2192 회피 스킬 제작 \u2192 사용자 설치 \u2192 코드 실행 \u2192 지속성 확보 \u2192 자격 증명 수집"

  - name: 스킬 공급망 공격
    steps: [T-ACCESS-005, T-EVADE-004, T-EXEC-005, T-PERSIST-002, T-EXFIL-004]
    description: "게시자 손상 \u2192 단계적 페이로드 배포 \u2192 업데이트 시 실행 \u2192 지속성 유지 \u2192 대화 기록 유출"

  - name: 프롬프트 인젝션으로 원격 코드 실행
    steps: [T-ACCESS-006, T-EXEC-001, T-EVADE-003, T-EXEC-004, T-IMPACT-001]
    description: "채널 접근 \u2192 프롬프트 주입 \u2192 승인 조작 \u2192 검사 우회 \u2192 명령 실행"

  - name: 간접 인젝션 데이터 탈취
    steps: [T-EXEC-002, T-DISC-004, T-EXFIL-001]
    description: "가져온 콘텐츠 오염 \u2192 환경 열거 \u2192 web_fetch를 통한 유출"

  - name: 토큰 탈취 지속 접근
    steps: [T-ACCESS-003, T-PERSIST-004, T-DISC-002, T-EXFIL-002]
    description: "토큰 탈취 \u2192 접근 유지 \u2192 세션 데이터 추출 \u2192 메시지를 통한 유출"

  - name: 금융 사기 체인
    steps: [T-ACCESS-006, T-EXEC-001, T-DISC-001, T-IMPACT-005]
    description: "채널 접근 획득 \u2192 프롬프트 주입 \u2192 금융 도구 열거 \u2192 사기 실행"

trust_boundaries:
  # 순서는 실제 사용자/데이터 흐름을 따릅니다:
  # 공급망 (사전 설치) → 채널 접근 (메시지 수신) → 세션 (라우팅) → 실행 + 외부 콘텐츠 (인접)
  - id: 1
    name: 공급망
    zone: ClawHub
    phase: pre-install
    controls:
      - 스킬 게시 (시맨틱 버전, SKILL.md 필수)
      - 패턴 기반 검수 플래그
      - VirusTotal Code Insight
      - GitHub 계정 생성 일자 확인

  - id: 2
    name: 채널 접근 제어
    zone: Gateway
    phase: message-flow
    controls:
      - 기기 페어링 (30초 유예)
      - AllowFrom / AllowList 검증
      - 토큰/비밀번호/Tailscale 인증

  - id: 3
    name: 세션 격리
    zone: Agent Sessions
    phase: message-flow
    controls:
      - "세션 키 = agent:channel:peer"
      - 에이전트별 도구 정책
      - 대화 기록 로깅

  - id: 4
    name: 도구 실행
    zone: Execution Sandbox
    phase: execution
    adjacent: 5
    controls:
      - Docker 샌드박스 또는 호스트 (실행 승인)
      - Node 원격 실행
      - SSRF 보호 (DNS 고정 + IP 차단)

  - id: 5
    name: 외부 콘텐츠
    zone: Fetched URLs / Emails / Webhooks
    phase: execution
    adjacent: 4
    controls:
      - 외부 콘텐츠 래핑 (XML 태그)
      - 보안 알림 주입

data_flows:
  - id: F1
    source: Channel
    destination: Gateway
    data: 사용자 메시지
    protection: TLS, AllowFrom
  - id: F2
    source: Gateway
    destination: Agent
    data: 라우팅된 메시지
    protection: 세션 격리
  - id: F3
    source: Agent
    destination: Tools
    data: 도구 호출
    protection: 정책 적용
  - id: F4
    source: Agent
    destination: External
    data: web_fetch 요청
    protection: SSRF 차단
  - id: F5
    source: ClawHub
    destination: Agent
    data: 스킬 코드
    protection: 검수, 검사
  - id: F6
    source: Agent
    destination: Channel
    data: 응답
    protection: 출력 필터링

supply_chain:
  current_controls:
    - control: GitHub 계정 생성 일자
      implementation: requireGitHubAccountAge()
      effectiveness: 중간 - 신규 공격자의 진입 장벽 상승
    - control: 경로 정화
      implementation: sanitizePath()
      effectiveness: 높음 - 경로 탐색 방지
    - control: 파일 유형 검증
      implementation: isTextFile()
      effectiveness: 중간 - 텍스트 파일만 가능하나 여전히 악성일 수 있음
    - control: 크기 제한
      implementation: 50MB 총 번들
      effectiveness: 높음 - 리소스 고갈 방지
    - control: SKILL.md 필수
      implementation: 필수 리드미
      effectiveness: 보안 가치 낮음 - 정보 제공 목적만
    - control: 패턴 검수
      implementation: moderation.ts의 FLAG_RULES
      effectiveness: 낮음 - 쉽게 우회 가능
    - control: 검수 상태
      implementation: moderationStatus 필드
      effectiveness: 중간 - 수동 검토 가능

  moderation_patterns:
    description: moderation.ts의 현재 패턴
    patterns:
      - name: 알려진 악성 식별자
        regex: "/(keepcold131\\/ClawdAuthenticatorTool|ClawdAuthenticatorTool)/i"
      - name: 의심스러운 키워드
        regex: "/(malware|stealer|phish|phishing|keylogger)/i"
      - name: 자격 증명 키워드
        regex: "/(api[-_ ]?key|token|password|private key|secret)/i"
      - name: 금융 키워드
        regex: "/(wallet|seed phrase|mnemonic|crypto)/i"
      - name: 의심스러운 URL
        regex: "/(discord\\.gg|webhook|hooks\\.slack)/i"
      - name: 원격 코드 실행
        regex: "/(curl[^\\n]+\\|\\s*(sh|bash))/i"
      - name: URL 단축기
        regex: "/(bit\\.ly|tinyurl\\.com|t\\.co|goo\\.gl|is\\.gd)/i"
    limitations:
      - slug, displayName, summary, 프론트매터, 메타데이터, 파일 경로만 확인
      - 실제 스킬 코드 콘텐츠를 분석하지 않음
      - 단순 정규식은 난독화로 쉽게 우회됨
      - 행위 분석 없음

  planned_improvements:
    - improvement: VirusTotal 연동
      status: 진행 중
      impact: 높음 - Code Insight 행위 분석
    - improvement: 커뮤니티 신고
      status: 부분 구현 (skillReports 테이블 존재)
      impact: 중간
    - improvement: 감사 로깅
      status: 부분 구현 (auditLogs 테이블 존재)
      impact: 중간
    - improvement: 배지 시스템
      status: 구현 완료
      impact: "중간 - highlighted, official, deprecated, redactionApproved"

risk_matrix:
  - threat: T-EXEC-001
    likelihood: High
    impact: Critical
    risk_level: Critical
    priority: P0
  - threat: T-PERSIST-001
    likelihood: High
    impact: Critical
    risk_level: Critical
    priority: P0
  - threat: T-EXFIL-003
    likelihood: Medium
    impact: Critical
    risk_level: Critical
    priority: P0
  - threat: T-IMPACT-001
    likelihood: Medium
    impact: Critical
    risk_level: High
    priority: P1
  - threat: T-EXEC-002
    likelihood: High
    impact: High
    risk_level: High
    priority: P1
  - threat: T-EXEC-004
    likelihood: Medium
    impact: High
    risk_level: High
    priority: P1
  - threat: T-ACCESS-003
    likelihood: Medium
    impact: High
    risk_level: High
    priority: P1
  - threat: T-EXFIL-001
    likelihood: Medium
    impact: High
    risk_level: High
    priority: P1
  - threat: T-IMPACT-002
    likelihood: High
    impact: Medium
    risk_level: High
    priority: P1
  - threat: T-EVADE-001
    likelihood: High
    impact: Medium
    risk_level: Medium
    priority: P2
  - threat: T-ACCESS-001
    likelihood: Low
    impact: High
    risk_level: Medium
    priority: P2
  - threat: T-ACCESS-002
    likelihood: Low
    impact: High
    risk_level: Medium
    priority: P2
  - threat: T-PERSIST-002
    likelihood: Low
    impact: High
    risk_level: Medium
    priority: P2

recommendations:
  immediate_p0:
    - id: R-001
      recommendation: VirusTotal 연동 완료
      addresses: [T-PERSIST-001, T-EVADE-001]
    - id: R-002
      recommendation: 스킬 샌드박싱 구현
      addresses: [T-PERSIST-001, T-EXFIL-003]
    - id: R-003
      recommendation: 민감한 작업에 대한 출력 검증 추가
      addresses: [T-EXEC-001, T-EXEC-002]

  short_term_p1:
    - id: R-004
      recommendation: 속도 제한 구현
      addresses: [T-IMPACT-002]
    - id: R-005
      recommendation: 저장 시 토큰 암호화 추가
      addresses: [T-ACCESS-003]
    - id: R-006
      recommendation: 실행 승인 UX 및 검증 개선
      addresses: [T-EXEC-004]
    - id: R-007
      recommendation: web_fetch에 대한 URL 허용 목록 구현
      addresses: [T-EXFIL-001]

  medium_term_p2:
    - id: R-008
      recommendation: 가능한 경우 암호화 채널 검증 추가
      addresses: [T-ACCESS-002]
    - id: R-009
      recommendation: 설정 무결성 검증 구현
      addresses: [T-PERSIST-003]
    - id: R-010
      recommendation: 업데이트 서명 및 버전 고정 추가
      addresses: [T-PERSIST-002]

atlas_technique_mapping:
  - atlas_id: AML.T0006
    name: 능동적 스캐닝
    threats: [T-RECON-001, T-RECON-002, T-RECON-003]
  - atlas_id: AML.T0009
    name: 수집
    threats: [T-EXFIL-001, T-EXFIL-002, T-EXFIL-003, T-EXFIL-004]
  - atlas_id: AML.T0010.001
    name: "공급망: AI 소프트웨어"
    threats: [T-ACCESS-004, T-ACCESS-005, T-EXEC-005, T-PERSIST-001, T-PERSIST-002]
  - atlas_id: AML.T0010.002
    name: "공급망: 데이터"
    threats: [T-PERSIST-003]
  - atlas_id: AML.T0031
    name: AI 모델 무결성 침식
    threats: [T-IMPACT-001, T-IMPACT-002, T-IMPACT-003, T-IMPACT-004, T-IMPACT-005]
  - atlas_id: AML.T0040
    name: AI 모델 추론 API 접근
    threats: [T-ACCESS-001, T-ACCESS-002, T-ACCESS-003, T-PERSIST-004, T-DISC-001, T-DISC-002, T-DISC-003, T-DISC-004]
  - atlas_id: AML.T0043
    name: 적대적 데이터 제작
    threats: [T-EXEC-004, T-EVADE-001, T-EVADE-002, T-EVADE-003, T-EVADE-004]
  - atlas_id: AML.T0051.000
    name: "LLM 프롬프트 인젝션: 직접"
    threats: [T-ACCESS-006, T-EXEC-001, T-EXEC-003, T-EXEC-006, T-PERSIST-005]
  - atlas_id: AML.T0051.001
    name: "LLM 프롬프트 인젝션: 간접"
    threats: [T-EXEC-002]

key_security_files:
  - path: src/infra/exec-approvals.ts
    purpose: 명령 승인 로직
    risk_level: Critical
  - path: src/gateway/auth.ts
    purpose: 게이트웨이 인증
    risk_level: Critical
  - path: src/web/inbound/access-control.ts
    purpose: 채널 접근 제어
    risk_level: Critical
  - path: src/infra/net/ssrf.ts
    purpose: SSRF 보호
    risk_level: Critical
  - path: src/security/external-content.ts
    purpose: 프롬프트 인젝션 완화
    risk_level: Critical
  - path: src/agents/sandbox/tool-policy.ts
    purpose: 도구 정책 적용
    risk_level: Critical
  - path: convex/lib/moderation.ts
    purpose: ClawHub 검수
    risk_level: High
  - path: convex/lib/skillPublish.ts
    purpose: 스킬 게시 흐름
    risk_level: High
  - path: src/routing/resolve-route.ts
    purpose: 세션 격리
    risk_level: Medium

glossary:
  ATLAS: "MITRE의 AI 시스템을 위한 적대적 위협 환경"
  ClawHub: "OpenClaw의 스킬 마켓플레이스"
  Gateway: "OpenClaw의 메시지 라우팅 및 인증 레이어"
  MCP: Model Context Protocol - 도구 제공자 인터페이스
  Prompt Injection: 악성 명령이 입력에 삽입되는 공격
  Skill: OpenClaw 에이전트를 위한 다운로드 가능한 확장 기능
  SSRF: 서버 측 요청 위조
