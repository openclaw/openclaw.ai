---
import Analytics from '@vercel/analytics/astro';
import SpeedInsights from '@vercel/speed-insights/astro';

interface Props {
  title: string;
  description?: string;
  canonicalUrl?: string;
}

const {
  title,
  description = "OpenClaw â€” The AI that actually does things. Your personal assistant on any platform.",
  canonicalUrl = "https://openclaw.ai/",
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <meta name="color-scheme" content="light dark" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="canonical" href={canonicalUrl} />
    <link rel="alternate" type="application/rss+xml" title="OpenClaw Blog" href="/rss.xml" />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content="https://openclaw.ai/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="https://openclaw.ai/og-image.png" />

    <!-- Fonts: Bricolage Grotesque + Manrope from Google Fonts (matching ClawHub) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;500;600;700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">

    <title>{title}</title>

    <script is:inline>
      (() => {
        const key = 'oc-theme';
        const saved = localStorage.getItem(key);
        const preference = saved === 'light' || saved === 'dark' || saved === 'system' ? saved : 'system';
        
        const getEffectiveTheme = (pref) => {
          if (pref === 'system') {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          }
          return pref;
        };
        
        const theme = getEffectiveTheme(preference);
        document.documentElement.dataset.theme = theme;
        document.documentElement.dataset.themePreference = preference;
        document.documentElement.style.colorScheme = theme;
      })();
    </script>

    <style is:global>
      :root {
        /* ClawHub-inspired warm dark palette */
        --bg-deep: #1a1512;
        --bg-surface: #2a1f19;
        --bg-elevated: #3a2e26;

        /* ClawHub accent colors */
        --primary: #6B5549;
        --accent: #E65C46;
        
        /* Coral/Orange spectrum */
        --coral-bright: #E65C46;
        --coral-mid: #d94e38;
        --coral-dark: #c43f2a;

        /* Complementary cyan (for dark mode accents) */
        --cyan-bright: #00e5cc;
        --cyan-mid: #14b8a6;
        --cyan-glow: rgba(0, 229, 204, 0.4);

        /* Text */
        --text-primary: #F8F2ED;
        --text-secondary: #c4b5a8;
        --text-muted: #8a7a6d;

        /* Borders */
        --border-subtle: rgba(248, 242, 237, 0.12);
        --border-accent: rgba(230, 92, 70, 0.3);

        --surface-card: rgba(42, 31, 25, 0.65);
        --surface-card-strong: rgba(42, 31, 25, 0.85);
        --surface-overlay: rgba(0, 0, 0, 0.3);
        --surface-interactive: rgba(248, 242, 237, 0.1);
        --surface-interactive-hover: rgba(248, 242, 237, 0.15);
        --surface-cyan-soft: rgba(0, 229, 204, 0.15);
        --surface-coral-soft: rgba(230, 92, 70, 0.15);
        --surface-inset-highlight: rgba(248, 242, 237, 0.05);
        --newsletter-gradient:
          linear-gradient(
            135deg,
            rgba(230, 92, 70, 0.08) 0%,
            rgba(42, 31, 25, 0.8) 50%,
            rgba(0, 229, 204, 0.05) 100%
          );
        --press-featured-gradient:
          linear-gradient(135deg, rgba(230, 92, 70, 0.1) 0%, rgba(42, 31, 25, 0.7) 100%);
        --shadow-coral-soft: rgba(230, 92, 70, 0.2);
        --shadow-coral-mid: rgba(230, 92, 70, 0.3);
        --shadow-coral-strong: rgba(230, 92, 70, 0.4);
        --shadow-cyan-soft: rgba(0, 229, 204, 0.15);
        --shadow-github-soft: rgba(248, 242, 237, 0.1);
        --github-hover-color: #F8F2ED;
        --hero-title-start: #F8F2ED;
        --hero-title-end: #E65C46;
        --logo-gradient-start: #E65C46;
        --logo-gradient-end: #c43f2a;
        --logo-glow: rgba(230, 92, 70, 0.4);
        --logo-glow-hover: rgba(0, 229, 204, 0.5);

        /* Fonts - ClawHub style */
        --font-display: 'Bricolage Grotesque', system-ui, sans-serif;
        --font-body: 'Manrope', system-ui, sans-serif;
        --font-mono: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
      }

      html[data-theme='light'] {
        /* ClawHub light mode colors */
        --bg-deep: #F8F2ED;
        --bg-surface: #FFFFFF;
        --bg-elevated: #FEFCFB;

        --primary: #6B5549;
        --accent: #E65C46;

        --coral-bright: #E65C46;
        --coral-mid: #d94e38;
        --coral-dark: #c43f2a;

        --cyan-bright: #008f87;
        --cyan-mid: #00766e;
        --cyan-glow: rgba(0, 143, 135, 0.24);

        --text-primary: #2A1F19;
        --text-secondary: #6B5549;
        --text-muted: #8a7a6d;

        --border-subtle: rgba(42, 31, 25, 0.12);
        --border-accent: rgba(230, 92, 70, 0.3);

        --surface-card: rgba(255, 255, 255, 0.85);
        --surface-card-strong: rgba(255, 255, 255, 0.95);
        --surface-overlay: rgba(42, 31, 25, 0.1);
        --surface-interactive: rgba(42, 31, 25, 0.08);
        --surface-interactive-hover: rgba(42, 31, 25, 0.12);
        --surface-cyan-soft: rgba(0, 143, 135, 0.12);
        --surface-coral-soft: rgba(230, 92, 70, 0.12);
        --surface-inset-highlight: rgba(42, 31, 25, 0.05);
        --newsletter-gradient:
          linear-gradient(
            135deg,
            rgba(230, 92, 70, 0.08) 0%,
            rgba(255, 255, 255, 0.95) 52%,
            rgba(0, 143, 135, 0.08) 100%
          );
        --press-featured-gradient:
          linear-gradient(135deg, rgba(230, 92, 70, 0.1) 0%, rgba(255, 255, 255, 0.96) 100%);
        --shadow-coral-soft: rgba(230, 92, 70, 0.15);
        --shadow-coral-mid: rgba(230, 92, 70, 0.25);
        --shadow-coral-strong: rgba(230, 92, 70, 0.35);
        --shadow-cyan-soft: rgba(0, 143, 135, 0.2);
        --shadow-github-soft: rgba(42, 31, 25, 0.15);
        --github-hover-color: #2A1F19;
        --hero-title-start: #6B5549;
        --hero-title-end: #E65C46;
        --logo-gradient-start: #E65C46;
        --logo-gradient-end: #d94e38;
        --logo-glow: rgba(230, 92, 70, 0.25);
        --logo-glow-hover: rgba(0, 143, 135, 0.35);
      }

      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family: var(--font-body);
        background: var(--bg-deep);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* ClawHub theme transition effect */
      @keyframes theme-circle-transition {
        0% {
          clip-path: circle(0% at var(--theme-switch-x, 50%) var(--theme-switch-y, 50%));
        }
        100% {
          clip-path: circle(150% at var(--theme-switch-x, 50%) var(--theme-switch-y, 50%));
        }
      }

      html.theme-transition {
        view-transition-name: theme;
      }

      html.theme-transition::view-transition-old(theme) {
        mix-blend-mode: normal;
        animation: none;
        z-index: 1;
      }

      html.theme-transition::view-transition-new(theme) {
        mix-blend-mode: normal;
        z-index: 2;
        animation: theme-circle-transition 0.45s ease-out forwards;
      }

      @media (prefers-reduced-motion: reduce) {
        html.theme-transition::view-transition-old(theme),
        html.theme-transition::view-transition-new(theme) {
          animation: none !important;
        }
      }

      html[data-theme='light'] body {
        background:
          radial-gradient(1200px circle at 12% -10%, rgba(224, 53, 67, 0.04), transparent 58%),
          radial-gradient(900px circle at 88% -12%, rgba(0, 143, 135, 0.05), transparent 56%),
          var(--bg-deep);
      }

      ::selection {
        background: var(--coral-bright);
        color: var(--bg-deep);
      }

      html[data-theme='light'] .stars {
        opacity: 0.28;
        filter: saturate(0.6);
      }

      html[data-theme='light'] .nebula {
        opacity: 0.45;
      }

      /* ClawHub-style theme switcher - EXACT MATCH */
      .theme-switcher {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 999;
        display: flex;
        gap: 2px;
        padding: 2px;
        border-radius: 9999px;
        border: 1px solid var(--border-subtle);
        background: var(--surface-card-strong);
        backdrop-filter: blur(12px);
      }

      .theme-btn {
        width: 36px;
        height: 36px;
        display: grid;
        place-items: center;
        padding: 0;
        border: none;
        border-radius: 9999px;
        background: transparent;
        cursor: pointer;
        transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        color: var(--text-muted);
      }

      .theme-btn:hover:not(.active) {
        background: var(--surface-interactive);
        color: var(--text-secondary);
      }

      .theme-btn.active {
        background: var(--accent);
        color: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .theme-btn:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      .theme-icon {
        font-size: 1rem;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      @media (max-width: 640px) {
        .theme-switcher {
          top: 12px;
          right: 12px;
        }
        
        .theme-btn {
          width: 32px;
          height: 32px;
        }
        
        .theme-icon {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="theme-switcher">
      <button class="theme-btn" type="button" data-theme-btn="system" aria-label="System theme" title="System theme">
        <svg class="theme-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/>
        </svg>
      </button>
      <button class="theme-btn" type="button" data-theme-btn="light" aria-label="Light theme" title="Light theme">
        <svg class="theme-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/>
        </svg>
      </button>
      <button class="theme-btn" type="button" data-theme-btn="dark" aria-label="Dark theme" title="Dark theme">
        <svg class="theme-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
        </svg>
      </button>
    </div>
    <slot />
    <Analytics />
    <SpeedInsights />

    <script is:inline>
      (() => {
        const key = 'oc-theme';
        const root = document.documentElement;
        const buttons = document.querySelectorAll('[data-theme-btn]');
        if (!buttons.length) return;

        const getEffectiveTheme = (preference) => {
          if (preference === 'system') {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          }
          return preference;
        };

        const cleanupTransition = () => {
          root.classList.remove('theme-transition');
          root.style.removeProperty('--theme-switch-x');
          root.style.removeProperty('--theme-switch-y');
        };

        const applyTheme = (preference, context = null, persist = true) => {
          const currentPreference = root.dataset.themePreference;
          if (currentPreference === preference) return;

          const effectiveTheme = getEffectiveTheme(preference);
          const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          
          const updateTheme = () => {
            root.dataset.theme = effectiveTheme;
            root.dataset.themePreference = preference;
            root.style.colorScheme = effectiveTheme;
            
            // Update button states
            buttons.forEach(btn => {
              const btnTheme = btn.getAttribute('data-theme-btn');
              if (btnTheme === preference) {
                btn.classList.add('active');
              } else {
                btn.classList.remove('active');
              }
            });
            
            if (persist) {
              localStorage.setItem(key, preference);
            }
          };

          // Use View Transitions API if available and not reduced motion
          if (!prefersReducedMotion && document.startViewTransition && context) {
            const rect = context.getBoundingClientRect();
            const x = (rect.left + rect.width / 2) / window.innerWidth * 100;
            const y = (rect.top + rect.height / 2) / window.innerHeight * 100;
            
            root.style.setProperty('--theme-switch-x', `${x}%`);
            root.style.setProperty('--theme-switch-y', `${y}%`);
            root.classList.add('theme-transition');

            const transition = document.startViewTransition(() => {
              updateTheme();
            });

            transition.finished.then(() => {
              cleanupTransition();
            }).catch(() => {
              cleanupTransition();
            });
          } else {
            updateTheme();
            cleanupTransition();
          }
        };

        // Listen for button clicks
        buttons.forEach(btn => {
          btn.addEventListener('click', (e) => {
            const preference = btn.getAttribute('data-theme-btn');
            applyTheme(preference, e.currentTarget);
          });
        });

        // Listen for system theme changes when in system mode
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        mediaQuery.addEventListener('change', () => {
          const currentPreference = root.dataset.themePreference;
          if (currentPreference === 'system') {
            applyTheme('system', null, false);
          }
        });

        // Initialize with current preference
        const currentPreference = root.dataset.themePreference || 'system';
        applyTheme(currentPreference, null, false);
      })();
    </script>
  </body>
</html>
